import{r as h,j as e,T as k,P as f,a as u}from"./index-DpSFrzVb.js";const v=({onAccept:n,onClose:t})=>{const[a,r]=h.useState(null),[s,i]=h.useState({acceptedTerms:!1,acceptedPrivacy:!1,isOptedInForPromotions:!1,isOptedInForEmailUpdates:!1}),p=o=>l=>{i({...s,[o]:l.target.checked})},m=o=>{r(o)},x=()=>{r(null)},c=o=>{if(o.preventDefault(),console.log("handleAcceptAndProceed invoked with preferences:",s),!s.acceptedTerms||!s.acceptedPrivacy){alert("You must accept the Privacy Policy and Terms of Service to proceed.");return}n(s)};return e.jsxs("div",{children:[e.jsx("div",{className:"google-modal-overlay",children:e.jsxs("div",{className:"google-modal-content",children:[e.jsx("div",{style:{boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.6)",padding:"20px",backgroundColor:"black",color:"white"},children:e.jsx("h3",{children:"Welcome! Please Review and Set Your Preferences"})}),e.jsxs("form",{children:[e.jsxs("div",{className:"check-boxes",style:{boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.6)",padding:"10px"},children:[e.jsx("input",{type:"checkbox",id:"termsOfService",checked:s.acceptedTerms,onChange:p("acceptedTerms"),className:"checkbox-input"}),e.jsxs("label",{htmlFor:"termsOfService",className:"checkbox-label",children:[e.jsx("p",{style:{color:"black"}}),"I agree to the"," ",e.jsx("span",{onClick:()=>m(e.jsx(k,{})),className:"modal-link",children:e.jsx("div",{style:{backgroundColor:"#007bff",color:"white",padding:"10px",margin:"10px"},children:"Terms of Service"})})]})]}),e.jsxs("div",{className:"check-boxes",style:{boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.6)",padding:"10px"},children:[e.jsx("input",{type:"checkbox",id:"privacyPolicy",checked:s.acceptedPrivacy,onChange:p("acceptedPrivacy"),className:"checkbox-input"}),e.jsxs("label",{htmlFor:"privacyPolicy",className:"checkbox-label",children:[e.jsx("p",{style:{color:"black"}}),"I agree to the"," ",e.jsx("span",{onClick:()=>m(e.jsx(f,{})),className:"modal-link",children:e.jsx("div",{style:{backgroundColor:"#007bff",color:"white",padding:"10px",margin:"10px"},children:"Privacy Policy"})})]})]}),e.jsxs("div",{className:"check-boxes",style:{boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.6)",padding:"10px"},children:[e.jsx("input",{type:"checkbox",id:"optInPromotions",checked:s.isOptedInForPromotions,onChange:p("isOptedInForPromotions"),className:"checkbox-input"}),e.jsx("label",{htmlFor:"optInPromotions",className:"checkbox-label",children:e.jsx("p",{style:{color:"black"},children:"Opt-in for Promotions"})})]}),e.jsxs("div",{className:"check-boxes",style:{boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.6)",padding:"10px",marginBottom:"50px"},children:[e.jsx("input",{type:"checkbox",id:"optInEmailUpdates",checked:s.isOptedInForEmailUpdates,onChange:p("isOptedInForEmailUpdates"),className:"checkbox-input"}),e.jsx("label",{htmlFor:"optInEmailUpdates",className:"checkbox-label",children:e.jsx("p",{style:{color:"black"},children:"Opt-in for Email Updates"})})]}),e.jsxs("div",{className:"check-boxes",children:[e.jsx("button",{onClick:c,className:"google-modal-close-button",children:"Accept and Proceed"}),e.jsx("button",{onClick:t,className:"google-modal-close-button",children:"Close"})]})]})]})}),a&&e.jsx("div",{className:"google-modal-overlay",children:e.jsxs("div",{className:"google-modal-content",children:[a,e.jsx("button",{onClick:x,className:"google-modal-close-button",children:"Close"})]})})]})};class g extends Error{}g.prototype.name="InvalidTokenError";function y(n){return decodeURIComponent(atob(n).replace(/(.)/g,(t,a)=>{let r=a.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}function j(n){let t=n.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return y(t)}catch{return atob(t)}}function w(n,t){if(typeof n!="string")throw new g("Invalid token specified: must be a string");t||(t={});const a=t.header===!0?0:1,r=n.split(".")[a];if(typeof r!="string")throw new g(`Invalid token specified: missing part #${a+1}`);let s;try{s=j(r)}catch(i){throw new g(`Invalid token specified: invalid base64 for part #${a+1} (${i.message})`)}try{return JSON.parse(s)}catch(i){throw new g(`Invalid token specified: invalid json for part #${a+1} (${i.message})`)}}const P=({onSuccess:n,onFailure:t})=>{const[a,r]=h.useState(!1),[s,i]=h.useState(null),p=async c=>{try{const{credential:o}=c;if(!o)throw new Error("Google Sign-In failed. No credentials received.");i(o);const l=await u.post("/google/check",{idToken:o});if(console.log("Backend /google/check response:",l.data),l.data.needsAcceptance)r(!0);else{const d=await u.post("/google",{idToken:o});if(console.log("Backend /google response:",d.data),d.data.success){const b=d.data.redirectUrl||"http://localhost:4001";window.location.href=b}else console.error("Login failed:",d.data.message),t("Google Sign-In failed.")}}catch(o){console.error("Error during Google Sign-In:",o),t("Google Sign-In failed.")}},m=c=>{console.log("Handling callback with response:",c),c.data.success?(console.log("Redirecting to:",c.data.redirectUrl),window.location.href=c.data.redirectUrl):(console.error("Error from backend:",c.data.message||"No message provided."),alert(c.data.message||"An error occurred while processing your request."))},x=async c=>{var o;if(console.log("handleAcceptAndProceed invoked with preferences:",c),!c.acceptedTerms||!c.acceptedPrivacy){alert("You must accept the Privacy Policy and Terms of Service to proceed.");return}try{const l=w(s).email;if(!l)throw new Error("Email is missing. Unable to proceed.");console.log("Sending API request to /google/accept-terms...");const d=await u.post("/google/accept-terms",{email:l,hasAcceptedTermsOfService:c.acceptedTerms,hasAcceptedPrivacyPolicy:c.acceptedPrivacy,isOptedInForPromotions:c.isOptedInForPromotions||!1,isOptedInForEmailUpdates:c.isOptedInForEmailUpdates||!1});console.log("API Response:",d),m(d)}catch(l){console.error("Error during preferences update:",((o=l.response)==null?void 0:o.data)||l.message),alert("An error occurred while updating preferences. Please try again.")}};return h.useEffect(()=>{const c="897147424144-ejj7pjpkbc66k7occksnjvg6ismgpg11.apps.googleusercontent.com",o=document.createElement("script");return o.src="https://accounts.google.com/gsi/client",o.async=!0,o.onload=()=>{window.google?(window.google.accounts.id.initialize({client_id:c,callback:p}),window.google.accounts.id.renderButton(document.getElementById("googleSignInDiv"),{theme:"outline",size:"large"})):console.error("Failed to initialize Google Identity Services.")},o.onerror=()=>{console.error("Failed to load Google Identity Services script.")},document.head.appendChild(o),()=>{document.head.removeChild(o)}},[]),e.jsx("div",{children:a?e.jsx(v,{isVisible:a,onAccept:x,onClose:()=>r(!1)}):e.jsx("div",{id:"googleSignInDiv",style:{width:"100%",marginTop:"10%"}})})};export{P as G};
