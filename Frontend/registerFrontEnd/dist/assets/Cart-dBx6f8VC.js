import{r as c,j as e,m as I,A as H,a as b,u as U}from"./index-DCcqGZwj.js";import{L as G}from"./loading-CeBhY24j.js";const Y=({receiverZip:n,onSelectRate:x,totalWeight:d,totalDimensions:p,isOpen:m,onToggle:o})=>{const[v,g]=c.useState(!1),[r,y]=c.useState([]),[i,h]=c.useState(!1),[u,P]=c.useState(null),$="81502",S=typeof m=="boolean",f=S?m:v,k=async()=>{h(!0);try{const a=await b.post("/register-rates/ups-rates",{shipperZip:$,receiverZip:n,weight:d,dimensions:{length:p.length,width:p.width,height:p.height}});y(a.data.ups||[])}catch(a){console.error("❌ Error fetching UPS rates:",a)}finally{h(!1)}},D=a=>{P(a.serviceName),x(a.serviceName,a.cost)},F=()=>{S?(o&&o(),m||k()):g(a=>{const j=!a;return j&&k(),j})};return e.jsxs("div",{className:"form-section",children:[e.jsx(I.button,{onClick:F,whileHover:{scale:1.05},whileTap:{scale:.95},className:"ups-button",children:"UPS Rates"}),f&&e.jsx("div",{className:"rate-dropdown",children:i?e.jsx(G,{}):r.length?e.jsx(H,{children:r.map((a,j)=>e.jsxs(I.button,{onClick:()=>D(a),initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},whileHover:{scale:1.02},whileTap:{scale:.98},className:`rate-option ${u===a.serviceName?"selected":""}`,style:{position:"relative",overflow:"hidden",width:"100%",padding:"8px",border:"none",background:"transparent"},children:[e.jsx(I.div,{initial:{width:"0%"},animate:{width:u===a.serviceName?"100%":"0%"},transition:{duration:.4},className:"absolute top-0 left-0 h-full bg-blue-600 opacity-20"}),e.jsxs("div",{className:"rate-option-content",style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",position:"relative",zIndex:1},children:[e.jsxs("div",{className:"rate-price",style:{fontWeight:"bold",fontSize:"1.2em"},children:["$",a.cost?a.cost.toFixed(2):"N/A"]}),e.jsxs("div",{className:"rate-details",style:{textAlign:"right",lineHeight:1.2},children:[e.jsx("div",{className:"rate-name",style:{fontSize:"1em",marginBottom:"4px"},children:a.serviceName}),e.jsx("div",{className:"rate-delivery",style:{fontSize:"0.9em",color:"#555"},children:a.estimatedDeliveryDate&&a.estimatedDeliveryDate!=="N/A"?`Est. Delivery: ${a.estimatedDeliveryDate} (${a.approxDays||"3-5 days"})`:"Est. Delivery Not Available"})]})]})]},j))}):e.jsx(I.p,{className:"no-rates",initial:{opacity:0},animate:{opacity:1},children:"No UPS rates available"})})]})},_="/assets/trash-BZNBF-0h.webp",J=({cart:n,receiverZip:x,shippingCost:d,taxAmount:p,grandTotal:m,selectedCarrier:o,selectedService:v,onClose:g})=>{const r=U(),y=async()=>{console.log("✅ Confirm Checkout Clicked!");const i={selectedCarrier:o,selectedService:v,shippingCost:d};try{const h=localStorage.getItem("sessionId");if(!h)throw new Error("Session ID not found.");await b.post("/register-cart/update-shipping",{sessionId:h,shippingDetails:i}),console.log("🚀 Shipping details stored in the database."),r("/checkout-options")}catch(h){console.error("Error saving shipping details:",h),alert("There was an error saving your shipping details. Please try again.")}};return e.jsx("div",{className:"cksm-modal-overlay",children:e.jsxs("div",{className:"cksm-modal-content",children:[e.jsx("h2",{className:"cksm-title",children:"Order Summary"}),e.jsxs("div",{className:"cksm-summary-details",children:[e.jsxs("div",{className:"cksm-detail-row",children:[e.jsx("span",{className:"cksm-detail-label",children:"Items in Cart:"}),e.jsx("span",{className:"cksm-detail-value",children:n.map(i=>e.jsxs("div",{children:[i.quantity,"x ",i.name," - $",i.price.toFixed(2)]},i.id))})]}),e.jsxs("div",{className:"cksm-detail-row",children:[e.jsx("span",{className:"cksm-detail-label",children:"Shipping Method:"}),e.jsx("span",{className:"cksm-detail-value",children:o?`${o} - ${v}`:"Not Selected"})]}),e.jsxs("div",{className:"cksm-detail-row",children:[e.jsx("span",{className:"cksm-detail-label",children:"Shipping Cost:"}),e.jsxs("span",{className:"cksm-detail-value",children:["$",d?d.toFixed(2):"Not Selected"]})]}),e.jsxs("div",{className:"cksm-detail-row",children:[e.jsx("span",{className:"cksm-detail-label",children:"Tax:"}),e.jsxs("span",{className:"cksm-detail-value",children:["$",p.toFixed(2)]})]}),e.jsxs("div",{className:"cksm-detail-row",children:[e.jsx("span",{className:"cksm-detail-label",children:"Grand Total:"}),e.jsx("span",{className:"cksm-detail-value",children:e.jsxs("strong",{children:["$",m.toFixed(2)]})})]})]}),e.jsxs("div",{className:"cksm-modal-buttons",children:[e.jsx("button",{onClick:y,className:"cksm-proceed-checkout",children:"Confirm & Proceed"}),e.jsx("button",{onClick:g,className:"cksm-cancel-button",children:"Cancel"})]})]})})},K=n=>!n||n.length<1?0:n.startsWith("9")?.0725:n.startsWith("1")?.08875:.06,ee=()=>{const[n,x]=c.useState([]),[d,p]=c.useState(0),[m,o]=c.useState(null),[v,g]=c.useState(!1),[r,y]=c.useState(""),[i,h]=c.useState(null),[u,P]=c.useState(!1),[$,S]=c.useState(!1),[f,k]=c.useState(null),[D,F]=c.useState(null),[a,j]=c.useState(null),T=U(),C=(()=>{let t=localStorage.getItem("sessionId");return t||(t=`guest_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,localStorage.setItem("sessionId",t)),t})(),Z=u?K(r):0,w=i?(d+i)*Z:0,q=i?d+i+w:d,A=()=>{if(!i||!f){alert("Please select a shipping option before proceeding.");return}S(!0)},M=()=>{const t={shippingCost:i,selectedCarrier:f,receiverZip:r,taxAmount:w,grandTotal:q};Cookies.set("shippingDetails",JSON.stringify(t),{expires:1}),T("/checkout-options")};c.useEffect(()=>{(async()=>{g(!0);try{const l=(await b.post("/register-cart/items",{sessionId:C})).data.cartDetails||[];x(l),E(l)}catch(s){console.error("❌ Error fetching cart items:",s),o("Error loading cart items.")}finally{g(!1)}})()},[C]);const E=t=>{const s=t.reduce((l,N)=>l+N.price*N.quantity,0);p(s)},z=n.reduce((t,s)=>t+s.weight*s.quantity,0),L=n.reduce((t,s)=>({length:t.length+s.length*s.quantity,width:Math.max(t.width,s.width),height:Math.max(t.height,s.height)}),{length:0,width:0,height:0}),R=async(t,s)=>{try{const l=n.map(N=>N.id===t?{...N,quantity:Math.max(1,s)}:N);x(l),E(l),await b.post("/register-cart/add-guest-cart",{sessionId:C,productId:t,quantity:s})}catch(l){console.error("Error updating quantity:",l),o("Failed to update quantity.")}},O=async t=>{try{await b.post("/register-cart/delete-cart-item",{sessionId:C,productId:t,quantity:0});const s=n.filter(l=>l.id!==t);x(s),E(s)}catch(s){console.error("Error deleting item:",s),o("Failed to remove item.")}},B=()=>{r.length===5&&/^\d+$/.test(r)?P(!0):alert("Please enter a valid 5-digit ZIP code.")};if(n.length===0)return e.jsxs("div",{className:"cart-container empty",children:[e.jsx("h2",{children:"Your cart is empty!"}),e.jsx("button",{onClick:()=>T("/store"),className:"cart-back-button",children:"Back to Store"})]});const W=(t,s,l)=>{k(t),F(s),h(l)};return e.jsx("div",{className:"cart-container",children:e.jsxs("div",{className:"cart-section",children:[e.jsx("h2",{className:"cart-title",children:"Your Cart"}),m&&e.jsx("p",{className:"cart-error",children:m}),e.jsx("div",{className:"cart-items",children:n.map(t=>e.jsxs("div",{className:"cart-item",children:[e.jsxs("div",{className:"cart-item-info",children:[e.jsx("img",{src:`http://localhost:3450/uploads/${t.thumbnail}`,alt:t.name,className:"cart-item-image"}),e.jsxs("div",{className:"cart-item-details",children:[e.jsx("h4",{className:"cart-item-name",children:t.name}),e.jsxs("p",{className:"cart-item-price",children:["$",t.price.toFixed(2)]})]}),e.jsx("img",{src:_,alt:"Delete",className:"delete-icon",onClick:()=>O(t.id)})]}),e.jsxs("div",{className:"cart-item-quantity-control",children:[e.jsx("button",{className:"quantity-button",onClick:()=>R(t.id,t.quantity-1),children:"-"}),e.jsx("input",{type:"number",value:t.quantity,onChange:s=>R(t.id,parseInt(s.target.value,10))}),e.jsx("button",{className:"quantity-button",onClick:()=>R(t.id,t.quantity+1),children:"+"})]})]},t.id))}),e.jsxs("div",{className:"shipping-section",children:[e.jsx("label",{htmlFor:"zip",children:"Enter ZIP Code:"}),e.jsx("input",{type:"text",id:"zip",value:r,onChange:t=>y(t.target.value),placeholder:"Enter your ZIP code",disabled:u}),e.jsx("button",{className:"zip-button",onClick:B,disabled:u,children:u?"ZIP Code Submitted":"Submit ZIP Code"})]}),u&&e.jsx("div",{className:"carrier-buttons",children:e.jsx(Y,{receiverZip:r,totalWeight:z,totalDimensions:L,onSelectRate:(t,s)=>W("UPS",t,s),isOpen:a==="UPS",onToggle:()=>j(a==="UPS"?null:"UPS")})}),e.jsxs("div",{className:"shipping-summary",children:[e.jsxs("h3",{children:["Shipping Cost: ",i?`$${i.toFixed(2)}`:"Not Selected"]}),i&&e.jsxs(e.Fragment,{children:[e.jsxs("h4",{children:["Tax (",(Z*100).toFixed(2),"%): $",w.toFixed(2)]}),e.jsxs("h3",{children:["Grand Total: $",q.toFixed(2)]})]})]}),e.jsx("button",{onClick:A,className:`proceed-checkout ${i?"":"disabled"}`,children:"Proceed to Checkout"}),$&&e.jsx(J,{cart:n,shippingCost:i,taxAmount:w,grandTotal:q,selectedCarrier:f,selectedService:D,receiverZip:r,onClose:()=>S(!1),onConfirm:M})]})})};export{ee as default};
